---
title: "Patrick McCaslin - Baltimore Banner"
output: html_document
date: "2025-05-07"
---

#rsw comment: cut the template material and focus on your project

Here's what your newsroom suggested for a project: As far as I can tell, no one has ever done an income vs. student test scores analysis in Maryland. We are going to try to do one for the entire state. Patrick can start with whatever we have in here. He should plan to have 23 counties worth of data for his final analysis.

Google Drive link that has some of the data in it. I will compile more of it into this folder as I wrangle things together. <https://drive.google.com/drive/folders/1INQ7mIAQ_PwJgA2kSylllJm1KjJwVYNk?usp=drive_link>

**#rsw comment: basically start your project here**

# **Story memo**

**Patrick McCaslin, patrick.mccaslin\@thebaltimorebanner.com, June 2, 2025**

**Subject:**

This story will investigate the relationship between a family's median income and a public school's performance on Maryland's state test, the MCAP. Depending on the strength of the correlation, it will look at how household income may affect a student's experience in school and discuss the effect of The Blueprint for Maryland's Future on ameliorating this issue.

**#rsw comment: what we think we will find: that schools with lower incomes are performing terribly on the tests**

**Relevance:**

In early April, Maryland legislators concluded a standoff with Gov. Wes Moore surrounding the Blueprint. They gutted Moore's bill to defund the Blueprint over the course of four years. Among~~st~~ other requests, it specifically called to defund the provision that increased funding for students who live in areas with concentrated poverty.

Understanding income's effect on the performance of schools may provide important context to understanding the use of the Blueprint.

**Target audience:**

Primarily parents of students in public schools. Secondarily, politically-minded readers who may have a strong opinion about allocating such a large part of the budget to the Blueprint.

**Potential sources:**

-   Legislators who lobbied to keep the Blueprint fully funded
-   Administrator/teacher/student at a school that performed particularly well on the MCAP and are based in a high income area. What are their keys to success?
-   Administrator/teacher/student at a school that perofrmed poorly on the MCAP and is based in a low income area.
-   Person at an outlier school (e.g. high income/low score or low income/high score)

**Potential impact:**

Depending on the level of correlation, this may influence voters' opinions on the Blueprint and affect how the state allocates money in the future. It could also illuminate an important underlying factor in educational success, especially if it seems to affect certain districts more than others.

**Surprising observations:**

-   A cursory review of the data indicates that some high income schools may perform abysmally and vice versa. If these are outliers, they may be interesting cases to investigate to determine how these schools differentiate themselves from others.
-   There does appear to be a correlation between income and test scores. While this is somewhat intuitive, there is little research and few articles to reflect this. Instead, the articles focus on SAT/ACT and income correlation, which has drawn scrutiny.
-   There has been criticism around news organizations drawing connections between SAT/ACT scores and household income due to the tendency to group scores and group income levels which decreases the ability to determine correlation. Focusing on school scores allows for more datapoints and better estimates.

**Visuals:**

<iframe src='https://flo.uri.sh/visualisation/23619455/embed' title='Interactive or visual content' class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:100%;height:600px;' sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe><div style='width:100%!;margin-top:4px!important;text-align:right!important;'><a class='flourish-credit' href='https://public.flourish.studio/visualisation/23619455/?utm_source=embed&utm_campaign=visualisation/23619455' target='_top' style='text-decoration:none!important'><img alt='Made with Flourish' src='https://public.flourish.studio/resources/made_with_flourish.svg' style='width:105px!important;height:16px!important;border:none!important;margin:0!important;'> </a></div>

-   A scatterplot could provide a compelling visual for the correlation between income and test scores.
-   A dumbbell graph could be useful if the story evaluates change in test scores over time.

**Context:**

State test scores have largely stagnated over the past few years, regardless of race and location.**#rsw comment: and despite the state pouring millions of dollars into schools** For low-scoring districts, this indicates that schools are struggling to catch up and income could help illuminate the why. Especially now, the economy is an issue that is particularly relevant to Americans and showing its effect on educational outcomes could add to the picture. Additionally, the Blueprint has provisions for helping districts in poverty that have recently been called into question. This will be relevant as the state approaches its gubernatorial election and other local elections.

**Next steps:**

There is a fair bit of cleaning and information that I need to add to the scores table and the income table to determine if there is a correlation between income and test scores. This will include determining where the school serves and joining the tables.

**Estimated time of completion:**

Three weeks (Early July)

# Documentation of project

# Load software libraries

```{r}
#install.packages("tidyverse")
#install.packages("janitor")
#install.packages("readxl")
#install.packages("rvest")
#install.packages("ggmap")
#install.packages("geosphere")
#install.packages("sf")
#install.packages("tidycensus")

library(tidycensus)
library(tidyverse)
library(janitor)
library(readxl)
library(rvest)
library(ggmap)
library(geosphere)
library(sf)

```

# Load, clean, and sort the MD ELA test score data at school level

```{r}
ela_scores_2023 <- read.csv("../MCAP Scores/2023_MCAP_ELA_Scores.csv")

#If *, delete from df.

ela_scores_2023 <- ela_scores_2023 |>
  filter(Proficient.Pct != "*")

#Convert strings stored in Proficient.Pct to doubles. When <5, convert to 5. When >95 convert to 95. Pasted and modified from ChatGPT.

ela_scores_2023 <- ela_scores_2023 |> 
  mutate(
    Proficient.Pct = case_when( #new Proficient.Pct
      Proficient.Pct == "<= 5.0" ~ 5L,
      Proficient.Pct == ">= 95.0" ~ 95L,
      suppressWarnings(!is.na(as.numeric(Proficient.Pct))) ~ as.numeric(Proficient.Pct),
      TRUE ~ 0
    )
  )


ela_scores_2023 <- ela_scores_2023 |>
  filter(Assessment == " English Language Arts All Grades") |> 
  select(School.Name,Proficient.Pct) |>
  arrange(desc(Proficient.Pct))
view(ela_scores_2023)
```
# Find the relationship between school and per capita income

```{r}

#Gets per capita income data by zip code for the entire U.S. based off of 2023 ACS
percap_national_income2023 <- get_acs(geography = "zcta", 
              variables = "B19301_001", 
              year = 2023) |> 
              rename(Income_per_cap = estimate)

#Load shp file which contains zip codes of each school in Montgomery County. Only look at zip and school name.
schools <- st_read("../MCPS_GIS_Data_2024_2025 (1)/Schools.shp")

schools_zip <- schools |>
  select(schoolname,ZIP)

#Filter to only contain zip codes that are found in the Montgomery County school district

zip_incomes <- percap_national_income2023 |> 
#  mutate(NAME = str_remove(NAME, "ZCTA ")) |> 
  filter(GEOID %in% schools_zip$ZIP)
  
view(zip_incomes)

#Now join one to many. We have a df () which contains school names and zip codes. We have another df () which contains zip codes and income.

#First change column name from GEOID to ZIP to allow for join.

zip_incomes <- zip_incomes |> rename(ZIP = GEOID)

#And join! Now we have schools and income connected

schools_income <- left_join(schools_zip, zip_incomes, by = "ZIP")
view(schools_income)
```
# Now find the relationship between zip codes and schools

```{r}
library("stringr")



# Initialize vector to store matches
matched_schools <- character(nrow(schools_income))

# Loop through each name
for (i in seq_along(schools_income$schoolname)) {
  pattern <- paste0("\\b", schools_income$schoolname[i], "\\b")
  
  # Find matches
  matches <- ela_scores_2023$School.Name[str_detect(ela_scores_2023$School.Name, pattern)]
  
  # Choose match or manual. If manual, that means I would theoretically replace it manually for the correct value.
  if (length(matches) == 1) {
    matched_schools[i] <- matches
  } else {
    matched_schools[i] <- "MANUAL"
  }
}

#Add the school name column to matched schools
schools_income$schoolname <- matched_schools

#Filter out the manual rows. For these purposes, I don't really need a large or completely accurate sample.
schools_income <- schools_income |> 
  filter(schoolname != "MANUAL")

#Rename column for join
ela_scores_2023 <- ela_scores_2023 |> 
  rename(schoolname = School.Name)

#Join income with test scores
income_scores <- ela_scores_2023 |> 
  left_join(schools_income, by = "schoolname") |> 
  filter(ZIP != "NA")

```



```{r}

#Call Groq to help standardize school names between the two dfs.

#groq <- chat_groq()

#No fooling around Groq

#groq$chat("In the next few instructions, I want you to only give me the thing I'm asking for in R format. I don't want any intros or explanations or pleasentries. I want you to provide only the exact strucutred output I am seeking. If I ask for a vector, provide me with a vector. Do not provide me with a way to obtain the vector. Do not use Markdown code blocks or triple backticks.If you understand, give me a code for reading a csv called test.csv")

#groq$chat(paste("Go through the first 10 names in schoolname in schools_income$schoolname and replace it with the corresponding name in ela_scores_2023. Most times, the name used in schoolname corresponds to the last name of the school used in ela_scores_2023 If there are multiple feasible results, paste a note so that I know to manually replace it. Output the result as a vector."))
#schools_income$schoolname
#ela_scores_2023$School.Name
```

# Load shapefiles of Montgomery County schools

```{r}

#read in shp file for Montgomery County school district
districts <- st_read("../MCPS_GIS_Data_2024_2025 (1)/Schools.shp")

#read in shp file for clusters
clusters <- st_read("../MCPS_GIS_Data_2024_2025 (1)/Cluster.shp")

# map <- ggplot(data = clusters) +
#   geom_sf(fill = "lightblue", color = "black") +
#   theme_minimal() +
#   labs(title = "Map of Clusters")

#Trying to add outline of counties using Shapefile
mont_schools<- st_read("../data/montgomery_county/MCPS_GIS_Data_2024_2025/Schools.shp")
```

map your data

```{r}
 # map_plot <- ggplot(data = income_map, aes(x = X, y = Y)) +
 #   geom_polygon(fill = "white", color = "black") 
#+
#   geom_point(data = XXXX, aes(x = lynching.lon, y = lynching.lat, color = in_state), size = 3) +
#   coord_quickmap() +
#   theme_void() + 
#   labs(title="XXXX") + 
#   theme(axis.title.x = element_blank(),
#     axis.text.x = element_blank(),
#     axis.ticks.x = element_blank(),
#     axis.title.y = element_blank(),
#     axis.text.y = element_blank(),
#     axis.ticks.y = element_blank())
# 
# print(map_plot)
```

\`\`\`

Data details: Data files with Maryland School boundaries <https://drive.google.com/drive/folders/1INQ7mIAQ_PwJgA2kSylllJm1KjJwVYNk>

# Questions

Write down questions you want answered:

# Data Details

Documentation for Maryland test scores: <https://reportcard.msde.maryland.gov/>

This allows you to start the analysis by unified school district. You should hunt down the income data by high school, and elementary school district.

```{r}
#Filter for only the income rows, look at only the school name and percap income columns, and sort in descending order

# sorted_filtered_percap <- percap_income2023 |> 
#   filter(variable == "percap_income") |> 
#   select(NAME,estimate) |>
#   arrange(desc(estimate))
# view(sorted_filtered_percap)

```
